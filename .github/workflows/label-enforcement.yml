name: Require PR Label

permissions:
      contents: read
      pull-requests: read
      issues: read 

on:
  pull_request:
    types: [opened, synchronize, reopened, edited, ready_for_review, labeled, unlabeled]

jobs:
  check-label:
    runs-on: ubuntu-latest
    steps:
      - name: SemVer Label Check
        uses: actions/github-script@v7
        with:
          script: |
            if (context.payload.pull_request.draft) {
              core.info("Draft PR detected â€” skipping label check.");
              return;
            }
            
            const names = (context.payload.pull_request.labels || []).map(l => l.name);

            const semverLabels = [
              "breaking-change",                                  // MAJOR
              "feature",                                          // MINOR
              "fix", "perf", "refactor", "docs",
              "test", "build", "ci", "deps", "revert", "security" // PATCH
            ];

            const found = names.filter(name => semverLabels.includes(name));

            if (found.length === 0) {
              core.setFailed(
                "A SemVer label is required for pull requests. " +
                "Please add one of the labels below to continue:\n" +
                semverLabels.join(", ")
              );
            } else {
              core.info(`PR SemVer Label(s): ${found.join(", ")}`);
            }
